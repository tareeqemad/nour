# ุฅุนุฏุงุฏ ูุธุงู ุฅุดุนุงุฑุงุช ุงูุตูุงูุฉ ุงูุชููุงุฆู

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุฅูุดุงุก Command ููุชุญูู ูู ุงููููุฏุงุช
- **ุงูููู:** `app/Console/Commands/CheckMaintenanceNeeded.php`
- **ุงููุธููุฉ:** ุงูุชุญูู ูู ุงููููุฏุงุช ุงูุชู ุชุญุชุงุฌ ุตูุงูุฉ ูุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช

### 2. ุฅุถุงูุฉ Schedule
- **ุงูููู:** `routes/console.php`
- **ุงูุฌุฏููุฉ:**
  - ููููุงู ุงูุณุงุนุฉ 8:00 ุตุจุงุญุงู - ุงูุชุญูู ูู ุงููููุฏุงุช ุงูุชู ุชุญุชุงุฌ ุตูุงูุฉ ููุฑูุฉ
  - ุฃุณุจูุนูุงู ููู ุงูุงุซููู ุงูุณุงุนุฉ 8:00 ุตุจุงุญุงู - ุชุฐููุฑ ูุณุจู ูููููุฏุงุช ุงููุฑูุจุฉ

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชุดุบูู Command ูุฏููุงู

```bash
# ุงูุชุญูู ูู ุงููููุฏุงุช ุงูุชู ุชุญุชุงุฌ ุตูุงูุฉ (6 ุฃุดูุฑ)
php artisan maintenance:check

# ุงูุชุญูู ูุน ุชุฐููุฑ ูุณุจู (5 ุฃุดูุฑ)
php artisan maintenance:check --upcoming

# ุชุญุฏูุฏ ุนุฏุฏ ุงูุฃูุงู ูุฎุตุต
php artisan maintenance:check --days=90
```

### 2. ุฅุนุฏุงุฏ Cron Job (ููุชุดุบูู ุงูุชููุงุฆู)

ุฃุถู ุงูุณุทุฑ ุงูุชุงูู ุฅูู crontab:

```bash
* * * * * cd /path-to-your-project && php artisan schedule:run >> /dev/null 2>&1
```

ุฃู ูู Windows (Task Scheduler):

```cmd
php artisan schedule:work
```

---

## ๐ ุงููุนุงููุฑ ุงููุณุชุฎุฏูุฉ

### ุงููููุฏุงุช ุงูุชู ุชุญุชุงุฌ ุตูุงูุฉ ููุฑูุฉ:
- โ `last_major_maintenance_date` ูู `null` (ูู ูุชู ุตูุงูุฉ ุฃุจุฏุงู)
- โ ุฃู `last_major_maintenance_date` ุฃูุฏู ูู **6 ุฃุดูุฑ** (180 ููู)

### ุงููููุฏุงุช ุงููุฑูุจุฉ ูู ุงูุตูุงูุฉ (ุชุฐููุฑ ูุณุจู):
- โ `last_major_maintenance_date` ุจูู **5 ู 6 ุฃุดูุฑ** (150-180 ููู)

---

## ๐ ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ

### 1. ูููุดุบู (CompanyOwner):
- **ุงูููุน:** `maintenance_needed`
- **ุงูุนููุงู:** "ูููุฏ ูุญุชุงุฌ ุตูุงูุฉ ููุฑูุฉ"
- **ุงูุฑุณุงูุฉ:** ุชูุงุตูู ุงููููุฏ ูุชุงุฑูุฎ ุขุฎุฑ ุตูุงูุฉ
- **ุงูุฑุงุจุท:** ุตูุญุฉ ุฅุถุงูุฉ ุณุฌู ุตูุงูุฉ

### 2. ูุณูุทุฉ ุงูุทุงูุฉ/Admin/SuperAdmin:
- **ุงูููุน:** `maintenance_needed_summary`
- **ุงูุนููุงู:** "ูููุฏุงุช ุชุญุชุงุฌ ุตูุงูุฉ"
- **ุงูุฑุณุงูุฉ:** ุนุฏุฏ ุงููููุฏุงุช ุงูุชู ุชุญุชุงุฌ ุตูุงูุฉ
- **ุงูุฑุงุจุท:** ุตูุญุฉ ุณุฌูุงุช ุงูุตูุงูุฉ

### 3. ุชุฐููุฑ ูุณุจู (ุงุฎุชูุงุฑู):
- **ุงูููุน:** `maintenance_warning`
- **ุงูุนููุงู:** "ุชุฐููุฑ: ูููุฏ ูุญุชุงุฌ ุตูุงูุฉ ูุฑูุจุงู"
- **ุงูุฑุณุงูุฉ:** ุชูุงุตูู ุงููููุฏ ูุชุงุฑูุฎ ุขุฎุฑ ุตูุงูุฉ

---

## โ๏ธ ุงูุชุฎุตูุต

### ุชุบููุฑ ูุฏุฉ ุงูุตูุงูุฉ

ูู `routes/console.php`:

```php
Schedule::command('maintenance:check --days=90') // 3 ุฃุดูุฑ ุจุฏูุงู ูู 6
    ->daily()
    ->at('08:00');
```

### ุชุบููุฑ ููุช ุงูุชุดุบูู

```php
Schedule::command('maintenance:check')
    ->daily()
    ->at('10:00'); // ุงูุณุงุนุฉ 10 ุตุจุงุญุงู
```

### ุฅุถุงูุฉ ูุนุงููุฑ ุฃุฎุฑู

ูููู ุชุนุฏูู `getGeneratorsNeedingMaintenance()` ูู Command ูุฅุถุงูุฉ ูุนุงููุฑ ูุซู:
- ุนุฏุฏ ุณุงุนุงุช ุงูุชุดุบูู (`operating_hours`)
- ุงูุญุงูุฉ ุงููููุฉ (`technical_condition_id`)
- ููุน ุงููููุฏ

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ Command
```bash
php artisan maintenance:check
```

### 2. ุงุฎุชุจุงุฑ Schedule
```bash
php artisan schedule:list
```

### 3. ุชุดุบูู Schedule ูุฏููุงู
```bash
php artisan schedule:run
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุชุญุฏูุซ last_major_maintenance_date:**
   - ูุชู ุชุญุฏูุซู ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ุณุฌู ุตูุงูุฉ ูู ููุน "ุฏูุฑู" (PERIODIC)
   - ุฑุงุฌุน: `MaintenanceRecordController::store()`

2. **ููุน ุงูุฅุดุนุงุฑุงุช ุงูููุฑุฑุฉ:**
   - Command ูุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ ูู ููุณ ุงูููุน ูุจู ุฅูุดุงุก ุฌุฏูุฏุฉ
   - Dashboard Controller ูุณุชุฎุฏู `createOrUpdateNotification()` ูููุน ุงูุชูุฑุงุฑ

3. **ุงูุตูุงุญูุงุช:**
   - ุงููุดุบู (CompanyOwner) ูุฑู ููุท ูููุฏุงุชู
   - Admin/SuperAdmin/EnergyAuthority ูุฑูู ุฌููุน ุงููููุฏุงุช

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: Command ูุง ูุนูู
```bash
# ุชุญูู ูู ูุฌูุฏ Command
php artisan list | grep maintenance

# ุชุญูู ูู ุงูุฃุฎุทุงุก
php artisan maintenance:check -v
```

### ุงููุดููุฉ: Schedule ูุง ูุนูู
```bash
# ุชุญูู ูู Schedule
php artisan schedule:list

# ุชุดุบูู Schedule ูุฏููุงู ููุงุฎุชุจุงุฑ
php artisan schedule:run
```

### ุงููุดููุฉ: ุงูุฅุดุนุงุฑุงุช ูุง ุชุธูุฑ
- ุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ูุฏูู ุตูุงุญูุงุช
- ุชุญูู ูู ุฃู ุงููููุฏ ูุฑุชุจุท ุจูุดุบู
- ุชุญูู ูู logs: `storage/logs/laravel.log`

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-01-24
